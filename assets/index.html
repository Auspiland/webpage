<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Edge App — Monte Carlo & Normal Fit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      /* 최소한의 보조 스타일 (styles.css가 있으면 그대로 사용) */
      :root { --bg: #0f172a; --card:#111827; --muted:#94a3b8; --accent:#06b6d4; }
      body { margin: 0; background: linear-gradient(180deg,#0b1020,#0f172a 40%,#0b1020);
             color: #e5e7eb; font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans",Ubuntu,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"; }
      a { color: #8be9fd; text-decoration: none; }
      .wrap { max-width: 1080px; margin: 0 auto; padding: 24px; }
      header { display:flex; align-items:center; gap:12px; margin-bottom: 20px; }
      header h1 { margin:0; font-size: 1.6rem; letter-spacing: .2px; }
      .pill { padding:4px 10px; border-radius: 999px; background: #0ea5e9; color:#03131c; font-weight:600; font-size:.8rem; }
      .grid { display:grid; grid-template-columns: 1.1fr 1fr; gap: 18px; }
      .card { background: rgba(17,24,39,.65); border: 1px solid rgba(148,163,184,.18); border-radius: 14px; box-shadow: 0 8px 24px rgba(0,0,0,.35); overflow:hidden; }
      .card h2 { font-size: 1.05rem; margin: 0; padding: 14px 16px; border-bottom: 1px solid rgba(148,163,184,.12); background: rgba(2,6,23,.35); }
      .card .body { padding: 14px 16px; }
      .row { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .row .col { display:flex; flex-direction:column; gap:6px; }
      label { color:#cbd5e1; font-size:.88rem; }
      input, select { background:#0b1220; color:#e5e7eb; border:1px solid rgba(148,163,184,.25);
                      border-radius:10px; padding:10px 12px; outline:none; font-size:.95rem; }
      input:focus, select:focus { border-color:#22d3ee; box-shadow: 0 0 0 3px rgba(34,211,238,.15); }
      .actions { display:flex; gap:10px; align-items:center; margin-top: 12px; }
      button { background: linear-gradient(135deg,#06b6d4,#3b82f6); color:white; border:none; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer; }
      button.secondary { background: rgba(2,6,23,.6); border:1px solid rgba(148,163,184,.25); }
      .status { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
                white-space: pre-wrap; background:#0b1220; border:1px dashed rgba(148,163,184,.35); border-radius:10px; padding:10px 12px; color:#cbd5e1; }
      .imgwrap { display:flex; align-items:center; justify-content:center; background:#0b1220; border:1px solid rgba(148,163,184,.2); border-radius: 12px; min-height: 460px; }
      .imgwrap img { max-width:100%; height:auto; border-radius: 8px; display:none; }
      .imgwrap img.show { display:block; }
      .meta { color:#a5b4fc; font-size:.85rem; display:flex; gap:12px; flex-wrap:wrap; margin-top: 8px; }
      .badge { background: rgba(99,102,241,.18); border:1px solid rgba(99,102,241,.35); padding:4px 8px; border-radius: 999px; }
      footer { opacity:.7; margin-top: 22px; font-size:.86rem; }
      @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }

      /* 요약 테이블 스타일 */
      .toggle-btn { background: rgba(59,130,246,.2); color: #93c5fd; border: 1px solid rgba(59,130,246,.4);
                    border-radius: 8px; padding: 6px 12px; margin-bottom: 12px; cursor: pointer; font-size: 0.9rem;
                    transition: all 0.2s; }
      .toggle-btn:hover { background: rgba(59,130,246,.35); border-color: rgba(59,130,246,.6); }

      .summary-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
      .summary-table thead { background: rgba(2,6,23,.5); }
      .summary-table th { padding: 10px 12px; text-align: left; color: #a5b4fc; font-weight: 600;
                          border-bottom: 2px solid rgba(148,163,184,.25); font-size: 0.95rem; }
      .summary-table td { padding: 8px 12px; border-bottom: 1px solid rgba(148,163,184,.12); }
      .summary-table tbody tr:last-child td { border-bottom: none; }
      .summary-table tbody tr:hover { background: rgba(148,163,184,.08); }
      .summary-label { color: #a5b4fc; font-weight: 600; cursor: pointer; transition: color 0.2s; }
      .summary-label:hover { color: #c4b5fd; text-decoration: underline; }
      .summary-value { color: #e5e7eb; font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
                       text-align: right; }

      /* 설명 툴팁/모달 */
      .description-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.7);
                           display: none; align-items: center; justify-content: center; z-index: 9999; }
      .description-modal.active { display: flex; }
      .description-content { background: #1e293b; border: 1px solid rgba(148,163,184,.3); border-radius: 12px;
                             padding: 20px 24px; max-width: 600px; width: 90%; box-shadow: 0 12px 36px rgba(0,0,0,.5); }
      .description-content h3 { margin: 0 0 12px; color: #a5b4fc; font-size: 1.15rem; }
      .description-content p { margin: 0; color: #cbd5e1; line-height: 1.6; }
      .description-close { margin-top: 16px; text-align: right; }
      .description-close button { background: #475569; padding: 6px 16px; border-radius: 8px; cursor: pointer;
                                  color: white; border: none; font-weight: 600; }
      .description-close button:hover { background: #64748b; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <span class="pill">Cloudflare Workers (Python)</span>
        <h1>Monte Carlo Simulation & Normal Fit</h1>
      </header>

      <div class="grid">
        <!-- 좌: 폼 -->
        <section class="card">
          <h2>파라미터</h2>
          <div class="body">
            <form id="f">
              <div class="row">
                <div class="col">
                  <label>GAME_ID
                    <select name="GAME_ID" required>
                      <option value="1" selected>1</option>
                      <option value="2">2</option>
                    </select>
                  </label>
                </div>
                <div class="col">
                  <label>GOAL
                    <input name="GOAL" type="number" value="7" min="1" required />
                  </label>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="col">
                  <label>OBS_TOTAL (관측 총 뽑기 수)
                    <input name="OBS_TOTAL" type="number" value="888" min="1" required />
                  </label>
                </div>
              </div>

              <div class="actions">
                <button type="submit">/api/simulate 실행</button>
                <button type="button" id="btnReset" class="secondary">리셋</button>
                <button type="button" id="btnDownloadSvg" class="secondary" disabled>SVG 저장</button>
                <button type="button" id="btnDownloadJson" class="secondary" disabled>JSON 저장</button>
              </div>

              <div class="meta" id="rateMeta" style="display:none;">
                <span class="badge" id="rlLimit"></span>
                <span class="badge" id="rlRemain"></span>
                <span class="badge" id="rlReset"></span>
              </div>
            </form>
          </div>
        </section>

        <!-- 우: 결과/상태 -->
        <section class="card">
          <h2>요약 Summary</h2>
          <div class="body">
            <div class="status" id="summary">ready</div>
          </div>
        </section>
      </div>

      <section class="card" style="margin-top:18px;">
        <h2>분포 그래프</h2>
        <div class="body">
          <div class="imgwrap">
            <img id="plot" alt="분포 그래프" />
          </div>
        </div>
      </section>

      <footer>
        응답에 포함된 <code>image_svg</code>는 클라이언트에서 Blob URL로 변환하여 표시합니다.
        서버는 별도 Base64 인코딩 없이 전송하므로 응답 크기가 작고 빠릅니다.
      </footer>
    </div>

    <!-- 설명 모달 -->
    <div class="description-modal" id="descriptionModal">
      <div class="description-content">
        <h3 id="modalTitle"></h3>
        <p id="modalDescription"></p>
        <div class="description-close">
          <button id="closeModal">닫기</button>
        </div>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
